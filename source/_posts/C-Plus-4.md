---
title: C++学习笔记（四）内存分区模型
date: 2022-03-21 14:42:04
tags:
- C++学习
categories:
- [C++学习笔记]
- [C++面向对象]
---

# 分类

* C++程序在执行十，将内存方向大致分为4个区域：
    * 代码区：存放函数体的二进制代码，由操作系统管理；
    * 全局区：存放全局变量和静态变量以及常量；
    * 栈区：由编译器自动分配释放，存放函数的参数值、局部变量等；
    * 堆区：由程序员分配和释放，若程序员不释放，程序结束时由操作系统回收。

# 内存四区的意义

* 不同区域存放的数据，赋予不同的生命周期，给我们更大的灵活性。

# 程序运行前

* 在程序编译后，生成了exe可执行程序，未执行该程序前分为两个区域

## 代码区

* 存放CPU执行的机器指令；

* 特点：
    * **代码区是共享的**。共享的目的是对于频繁被执行的程序，只需要在内存中有一份代码即可；
    * **代码区是只读的**。使其只读的原因是防止程序意外地修改了它的指令。

## 全局区

* **全局变量和静态变量存放在此**。
* 全局区还包含了常量区，字符串常量和const修饰的全局常量也存放在此。
* 该区域的数据在程序结束后由**操作系统释放**。

### 变量

* 局部变量：写在函数体内的变量。

```c++
int main(){
    int a = 10;
}
```

* 全局变量：没有写在函数体内的变量。

```c++
int g_a = 10;
int main(){
    
}
```

* static修饰的变量。

```c++
int main(){
    static int a = 10;
}
```

### 常量

* 字符串常量：string。

```c++
int main(){
    string a = "Hello World!";
}
```

* const修饰的变量：
    * 全局常量：const修饰的全局变量；(全局区)
    * 局部常量：const修饰的局部变量。

```c++
const int c_g_a = 10;
int main(){
    const int c_a = 10;
}
```

# 程序运行后

## 栈区

* 由编译器自动分配释放，存放函数的参数值，局部变量等。
* 注意事项：不要返回局部变量的地址，栈区开辟的数据由编译器自动释放。

## 堆区

* 由程序员分配释放若程序员不释放,程序结剌时由操作系统回收；
* 在C++中主要利用new在堆区开辟内存。

```c++
int main(){
    int * p = new int(10);
}
```

## new操作符

* new操作符开辟数据，delete操作符进行释放。
* new返回的是该数据类型的指针。

```c++
//new创建数组
int main(){
    int * arr = new int[10];
    delete[] arr;
}
```